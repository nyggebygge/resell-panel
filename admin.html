<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Resell Panel</title>
    <link rel="stylesheet" href="css/core.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="bg-shape shape-1"></div>
        <div class="bg-shape shape-2"></div>
        <div class="bg-shape shape-3"></div>
        <div class="bg-shape shape-4"></div>
    </div>

    <!-- Admin Header -->
    <header class="admin-header">
        <div class="header-content">
            <div class="admin-logo">
                <i class="fas fa-shield-alt"></i>
                <h1>Admin Dashboard</h1>
            </div>
            <div class="admin-nav">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
                <button class="logout-btn" onclick="adminAuth.logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Admin Dashboard -->
    <main class="admin-dashboard">
        <!-- Admin Stats Overview -->
        <section class="admin-stats">
            <!-- Quick Actions -->
            <div class="admin-actions">
                <a href="revenue.html" class="action-btn revenue-btn">
                    <i class="fas fa-chart-line"></i>
                    <span>Revenue Analytics</span>
                </a>
                <button class="action-btn" onclick="adminUsers.exportUsers()">
                    <i class="fas fa-download"></i>
                    <span>Export Users</span>
                </button>
                <button class="action-btn" onclick="adminUsers.refreshUsers()">
                    <i class="fas fa-sync"></i>
                    <span>Refresh Data</span>
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-users">0</h3>
                        <p>Total Users</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="active-users">0</h3>
                        <p>Active Users</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-keys">0</h3>
                        <p>Total Keys</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-revenue">$0</h3>
                        <p>Total Revenue</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- User Management Section -->
        <section class="user-management">
            <div class="section-header">
                <h2><i class="fas fa-users-cog"></i> User Management</h2>
                <div class="section-actions">
                    <button class="action-btn primary" onclick="adminUsers.createUser()">
                        <i class="fas fa-plus"></i>
                        Add User
                    </button>
                    <button class="action-btn secondary" onclick="adminUsers.refreshUsers()">
                        <i class="fas fa-sync"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- User Filters -->
            <div class="user-filters">
                <div class="filter-group">
                    <input type="text" id="user-search" placeholder="Search users..." class="search-input">
                    <select id="status-filter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                    <select id="role-filter" class="filter-select">
                        <option value="">All Roles</option>
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
            </div>

            <!-- Users Table -->
            <div class="users-table-container">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="select-all-users" onchange="adminUsers.toggleSelectAll()">
                            </th>
                            <th onclick="adminUsers.sortUsers('username')">
                                Username <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="adminUsers.sortUsers('email')">
                                Email <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="adminUsers.sortUsers('credits')">
                                Credits <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="adminUsers.sortUsers('keysGenerated')">
                                Keys Generated <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="adminUsers.sortUsers('lastLogin')">
                                Last Login <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="adminUsers.sortUsers('isActive')">
                                Status <i class="fas fa-sort"></i>
                            </th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulk-actions" style="display: none;">
                <div class="bulk-info">
                    <span id="selected-count">0</span> users selected
                </div>
                <div class="bulk-buttons">
                    <button class="bulk-btn primary" onclick="adminUsers.activateSelected()">
                        <i class="fas fa-check"></i>
                        Activate
                    </button>
                    <button class="bulk-btn secondary" onclick="adminUsers.deactivateSelected()">
                        <i class="fas fa-times"></i>
                        Deactivate
                    </button>
                    <button class="bulk-btn danger" onclick="adminUsers.deleteSelected()">
                        <i class="fas fa-trash"></i>
                        Delete
                    </button>
                </div>
            </div>
        </section>


        <!-- System Monitoring -->
        <section class="system-monitoring">
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> System Monitoring</h2>
            </div>
            <div class="monitoring-grid">
                <div class="monitor-card">
                    <h3>Recent Activity</h3>
                    <div class="activity-list" id="recent-activity">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
                <div class="monitor-card">
                    <h3>System Health</h3>
                    <div class="health-metrics">
                        <div class="metric">
                            <span class="metric-label">Database</span>
                            <span class="metric-status healthy">Healthy</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">API</span>
                            <span class="metric-status healthy">Healthy</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Storage</span>
                            <span class="metric-status warning">85% Used</span>
                        </div>
                    </div>
                </div>
           </div>
       </section>

       <!-- Simple Key Import Section -->
       <section class="key-import-section">
           <div class="section-header">
               <h2><i class="fas fa-key"></i> Key Management</h2>
               <div class="section-actions">
                   <button class="action-btn primary" onclick="adminKeys.showImportModal()">
                       <i class="fas fa-upload"></i>
                       Import Keys
                   </button>
               </div>
           </div>
           <div class="section-content">
               <p>Import pre-generated keys to the unused keys database. These keys will be distributed to users when they generate keys.</p>
           </div>
       </section>
   </main>

    <!-- Import Keys Modal -->
    <div id="import-keys-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Pre-Generated Keys</h3>
                <button class="modal-close" onclick="adminKeys.closeImportModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="key-type">Key Type:</label>
                    <select id="key-type" class="form-input">
                        <option value="day">Day Keys</option>
                        <option value="week">Week Keys</option>
                        <option value="month">Month Keys</option>
                        <option value="lifetime">Lifetime Keys</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="keys-list">Keys (one per line):</label>
                    <textarea id="keys-list" class="form-textarea" rows="10" placeholder="Paste your pre-generated keys here, one per line..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn primary" onclick="adminKeys.processImport()">
                    <i class="fas fa-upload"></i>
                    Import Keys
                </button>
                <button class="btn secondary" onclick="adminKeys.closeImportModal()">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div id="create-user-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New User</h3>
                <button class="modal-close" onclick="adminUsers.closeCreateModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="create-user-form">
                    <div class="form-group">
                        <label for="new-username">Username</label>
                        <input type="text" id="new-username" required>
                    </div>
                    <div class="form-group">
                        <label for="new-email">Email</label>
                        <input type="email" id="new-email" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">Password</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <div class="form-group">
                        <label for="new-role">Role</label>
                        <select id="new-role">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-credits">Initial Credits</label>
                        <input type="number" id="new-credits" value="0">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn secondary" onclick="adminUsers.closeCreateModal()">
                            Cancel
                        </button>
                        <button type="submit" class="btn primary">
                            Create User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit User</h3>
                <button class="modal-close" onclick="adminUsers.closeEditModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id">
                    <div class="form-group">
                        <label for="edit-username">Username</label>
                        <input type="text" id="edit-username" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-email">Email</label>
                        <input type="email" id="edit-email" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-role">Role</label>
                        <select id="edit-role">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-credits">Credits</label>
                        <input type="number" id="edit-credits">
                    </div>
                    <div class="form-group">
                        <label for="edit-status">Status</label>
                        <select id="edit-status">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn secondary" onclick="adminUsers.closeEditModal()">
                            Cancel
                        </button>
                        <button type="submit" class="btn primary">
                            Update User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- JavaScript Modules -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/admin-users.js"></script>
    <script src="js/admin-keys.js"></script>
    <script src="js/admin-auth.js"></script>
    <script src="js/effects.js"></script>

    <script>
        // Initialize Admin Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Admin Dashboard initializing...');
            
            // Listen for auth system ready event
            document.addEventListener('authSystemReady', function() {
                console.log('✅ Auth system ready, checking admin access...');
                
                // Check if admin auth system is ready and user is admin
                if (window.adminAuth && window.adminAuth.isLoggedIn() && window.adminAuth.checkIsAdmin()) {
                    console.log('✅ Admin access confirmed, initializing dashboard');
                    // Initialize admin dashboard
                    if (window.adminDashboard) {
                        window.adminDashboard.init();
                    }
                } else {
                    console.log('❌ Admin access denied, redirecting to login');
                    window.location.href = 'login.html';
                }
            });
            
            // Fallback: if auth system is already ready
            setTimeout(() => {
                if (window.authManager && window.authManager.getIsLoggedIn()) {
                    document.dispatchEvent(new CustomEvent('authSystemReady'));
                }
            }, 1000);
        });
    </script>
</body>
</html>
